generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  DONOR
  FUND_RAISER
  ADMIN
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
}

enum DonationStatus {
  PENDING
  SUCCESS
  FAILED
}

model User {
  id                 String            @id @default(uuid(7))
  name               String
  email              String            @unique
  password           String
  role               UserRole          @default(DONOR)
  verificationStatus Boolean           @default(false) @map("verification_status")
  verificationToken  String?           @map("verification_token")
  resetToken         String?           @map("reset_token")
  resetTokenExpiry   DateTime?         @map("reset_token_expiry")
  createdAt          DateTime          @default(now()) @map("created_at")
  campaigns          Campaign[]
  donations          Donation[]
  paymentProviders   PaymentProvider[]
  paymentLogs        PaymentLog[]

  @@map("users")
}

model Campaign {
  id           String         @id @default(uuid(7))
  title        String
  description  String?
  type         String //â†’ donation | crowdfunding
  goalAmount   Decimal        @map("goal_amount")
  raisedAmount Decimal        @map("raised_amount")
  startDate    DateTime       @map("start_date")
  endDate      DateTime       @map("end_date")
  status       CampaignStatus @default(DRAFT)
  category     String
  createdAt    DateTime       @default(now()) @map("created_at")

  user         User       @relation(fields: [fundraiserId], references: [id])
  fundraiserId String     @map("fundraiser_id")
  donations    Donation[]

  @@map("campaigns")
}

model Donation {
  id         String  @id @default(uuid())
  campaignId String  @map("campaign_id")
  donorId    String? @map("donor_id")

  amount        Decimal
  status        DonationStatus @default(PENDING)
  isAnonymous   Boolean        @default(false)
  provider      String
  transactionId String?        @unique @map("transaction_id")
  createdAt     DateTime       @default(now()) @map("created_at")

  campaign Campaign @relation(fields: [campaignId], references: [id])
  donor    User?    @relation(fields: [donorId], references: [id])

  @@index([campaignId])
  @@index([donorId])
  @@map("donations")
}

model PaymentProvider {
  id        String   @id @default(uuid())
  name      String
  currency  String   @default("BDT")
  isActive  Boolean  @default(true) @map("is_active")
  config    Json
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  fundRaiser   User   @relation(fields: [fundRaiserId], references: [id])
  fundRaiserId String @map("fund_raiser_id")

  @@unique([id, fundRaiserId])
  @@map("payment_providers")
}

model PaymentLog {
  id                    String  @id @default(uuid())
  transactionId         String  @unique @map("transaction_id")
  valId                 String  @unique @map("val_id")
  amount                Decimal
  storeAmount           Decimal @map("store_amount")
  currency              String
  bankTranId            String  @map("bank_tran_id")
  cardType              String  @map("card_type")
  cardNo                String  @map("card_no")
  cardIssuer            String  @map("card_issuer")
  cardBrand             String  @map("card_brand")
  cardIssuerCountry     String  @map("card_issuer_country")
  cardIssuerCountryCode String  @map("card_issuer_country_code")
  currencyType          String  @map("currency_type")
  currencyAmount        Decimal @map("currency_amount")
  currencyRate          Decimal @map("currency_rate")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  fundRaiser   User   @relation(fields: [fundRaiserId], references: [id])
  fundRaiserId String @map("fund_raiser_id")

  @@map("payment_logs")
}
